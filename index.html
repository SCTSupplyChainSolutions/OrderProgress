<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Order Progress</title>
<style>
body { font-family: Montserrat, sans-serif; padding: 20px; }
.progress-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
  margin-top: 50px;
}
.progress-circle {
  width: 40px;
  height: 40px;
  background-color: #ADD8E6; /* light blue */
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1;
  position: relative;
  font-weight: bold;
  color: white;
}
.progress-line {
  height: 4px;
  background-color: #ccc; /* grey line */
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  z-index: 0;
  transform: translateY(-50%);
}
.stage-labels {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
}
.stage-label {
  width: 40px;
  text-align: center;
  font-weight: 500;
  font-size: 14px;
}
.completed {
  background-color: #4CAF50 !important; /* green for completed */
}
</style>
</head>
<body>

<h2>Order Progress</h2>

<div class="progress-container">
  <div id="line" class="progress-line"></div>
  <div id="CREATED" class="progress-circle">1</div>
  <div id="SHIPPED" class="progress-circle">2</div>
  <div id="ARRIVED" class="progress-circle">3</div>
  <div id="DELIVERED" class="progress-circle">4</div>
</div>

<div class="stage-labels">
  <div class="stage-label">Created</div>
  <div class="stage-label">Shipped</div>
  <div class="stage-label">Arrived</div>
  <div class="stage-label">Delivered</div>
</div>

<script>
const stages = [
    { name: "Created", key: "CREATED" },
    { name: "Shipped", key: "SHIPPED" },
    { name: "Arrived", key: "ARRIVED" },
    { name: "Delivered", key: "DELIVERED" }
];

// Read CLIENT_REF from URL parameters
const params = new URLSearchParams(window.location.search);
const clientRef = params.get('CLIENT_REF');

if(clientRef) {
    fetch(`http://192.168.13.201:6000/order-progress?CLIENT_REF=${clientRef}`)
    .then(res => res.json())
    .then(data => {
        stages.forEach((stage, index) => {
            const circle = document.getElementById(stage.key);
            if(data[stage.key]) {
                circle.classList.add('completed');
                circle.textContent = 'âœ”';
            }
        });
    })
    .catch(err => {
        console.error('Error fetching progress:', err);
        alert('Failed to fetch order progress.');
    });
} else {
    document.body.insertAdjacentHTML('beforeend', '<p>No CLIENT_REF provided.</p>');
}
</script>

</body>
</html>
