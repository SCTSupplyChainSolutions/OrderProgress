<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Order Progress</title>
<style>
body {
    font-family: Montserrat, sans-serif;
    padding: 20px;
}

.progress-stages {
    display: flex;
    justify-content: space-between; /* evenly space boxes */
    align-items: center;
    position: relative;
    margin-top: 50px;
}

.stage {
    flex: 1;
    max-width: 100px; /* optional max width */
    padding: 10px;
    background: #75aefa; /* light blue */
    text-align: center;
    border-radius: 10px;
    position: relative;
    z-index: 1;
}

/* Connecting line between boxes */
.progress-stages::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px; /* thinner line */
    background: #ccc;
    z-index: 0;
    transform: translateY(-50%);
}

/* Completed line (dynamic width via JS) */
#completed-line {
    position: absolute;
    top: 50%;
    left: 0;
    height: 2px;
    background: #4CAF50;
    transform: translateY(-50%);
    z-index: 0;
    width: 0;
    transition: width 0.3s;
}

.stage.completed {
    background: #4CAF50;
    color: white;
}
</style>
</head>
<body>
<h2>Order Progress</h2>

<div class="progress-stages">
    <div id="CREATED" class="stage">Created</div>
    <div id="SHIPPED" class="stage">Shipped</div>
    <div id="ARRIVED" class="stage">Arrived</div>
    <div id="DELIVERED" class="stage">Delivered</div>
    <div id="completed-line"></div> <!-- dynamic green line -->
</div>

<script>
const stages = [
    { name: "Created", key: "CREATED" },
    { name: "Shipped", key: "SHIPPED" },
    { name: "Arrived", key: "ARRIVED" },
    { name: "Delivered", key: "DELIVERED" }
];

const params = new URLSearchParams(window.location.search);
const clientRef = params.get('CLIENT_REF');

function updateLineProgress(completedCount) {
    const totalStages = stages.length;
    const container = document.querySelector('.progress-stages');
    const line = document.getElementById('completed-line');
    if (completedCount <= 1) {
        line.style.width = '0';
        return;
    }
    // Distance between first and last stage center
    const firstStage = container.children[0].getBoundingClientRect();
    const lastStage = container.children[completedCount - 1].getBoundingClientRect();
    const containerRect = container.getBoundingClientRect();
    const width = (lastStage.left + lastStage.width / 2) - (firstStage.left + firstStage.width / 2);
    line.style.width = width + 'px';
}

if (clientRef) {
    fetch(`http://192.168.13.201:6000/order-progress?CLIENT_REF=${clientRef}`)
        .then(res => res.json())
        .then(data => {
            let completedCount = 0;
            stages.forEach(stage => {
                const div = document.getElementById(stage.key);
                if (data[stage.key]) {
                    div.classList.add('completed');
                    div.textContent = `${stage.name} âœ”`;
                    completedCount++;
                }
            });
            updateLineProgress(completedCount);
            window.addEventListener('resize', () => updateLineProgress(completedCount)); // adjust line on resize
        })
        .catch(err => {
            console.error('Error fetching progress:', err);
            alert('Failed to fetch order progress.');
        });
} else {
    document.body.insertAdjacentHTML('beforeend', '<p>No CLIENT_REF provided.</p>');
}
</script>
</body>
</html>
